---
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "src/layouts/BaseLayout.astro";
import { marked } from 'marked';
import "@styles/blog.less";

export async function getStaticPaths() {
  const posts = await getCollection("deathMetal");
  return posts.map((entry) => ({
    params: { post: entry.slug },
    props: { post: entry },
  }));
}

const { post } = Astro.props;
const {
  title,
  band,
  country,
  location,
  status,
  genre,
  themes,
  currentLabel,
  bandMembers,
  discography,
  image,
  imageAlt,
  author,
} = post.data;
const { Content } = await post.render();

// Parse the Markdown strings
const parsedBandMembers = marked(bandMembers);
const parsedDiscography = marked(discography);
---

<BaseLayout {title}>
  <!-- ============================================ -->
  <!--                    LANDING                   -->
  <!-- ============================================ -->

  <!-- <Landing 
    title="Blog"
  /> -->

  <!-- ============================================ -->
  <!--              Main Blog Content               -->
  <!-- ============================================ -->

  <div class="blog-container main-content-wrapper">
    <!--Main content -->
    <div class="main-content">
      <!-- ============================================ -->
      <!--                  Blog Article                -->
      <!-- ============================================ -->

      <article class="blog-article">
        <!--Main Article Image-->
        <h1 class="blog-h1 text-center">{band}</h1>
        <picture class="blog-mainImage">
          <Image
            src={image}
            alt={imageAlt}
            width="795"
            height="795"
            decoding="async"
          />
        </picture>

        <!--Article Info-->
        <section id="blog-content">
          <p class="text-center font-medium text-xl">{country}</p>
          <p class="text-center font-medium text-xl">{location}</p>
          <p class="text-center font-medium text-xl">
            {status}
          </p>
          <p class="text-center font-medium text-xl">
            {genre}
          </p>

          <p class="text-center font-medium text-xl">
            {themes}
          </p>
          <p class="text-center font-medium text-xl">
            {currentLabel}
          </p>
          <section>
            <h2 class="text-center font-bold text-xl">Band Members</h2>
            <div set:html={parsedBandMembers}>
            </div>
          </section>
          <section>
            <h2 class="text-center font-bold text-xl">Discography</h2>
            <div set:html={parsedDiscography}>
            </div>
          </section>
          <Content />
        </section>
      </article>
    </div>
  </div>
</BaseLayout>

<style>
  iframe {
    width: 100%; /* Set the width to 100% */
    height: auto; /* Set height to auto to maintain aspect ratio */
    aspect-ratio: 16 / 9; /* Maintain the 16:9 aspect ratio */
    max-width: 760px; /* Optional: Set a max width */
  }
</style>
